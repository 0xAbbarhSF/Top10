# A10:2017 Недостатки журналирования и мониторинга

| Источники угроз/Векторы атак | Недостатки безопасности           | Последствия               |
| -- | -- | -- |
| Зависит от прил. : Сложность эксплуатации 2 | Распространенность 3 : Сложность обнаружения 1 | Технические 2 : Бизнес |
| Эксплуатация недостаточных логгирования и мониторинга является основой почти всех крупных инцидентов. Атакующие полагаются на отсутствие контроля и своевременного реагирования на достижение своих целей без обнаружения.  | Эта проблема включена в Топ-10 на основе [отраслевого опроса](https://owasp.blogspot.com/2017/08/owasp-top-10-2017-project-update.html). Одна из стратегий определения наличия достаточного мониторинга - это проверка журналов после тестирования на предмет проникновения. Действия тестеров должны регистрироваться в достаточной мере, чтобы понять, какие повреждения  могут нанести проникновения. | Большинство успешных атак начинаются с зондирования уязвимостей. Разрешение таких действий увеличивает вероятность успешного взлома почти  до 100%. В 2016 году выявление нарушения потребовало [в  среднем 191 день](https://www-01.ibm.com/common/ssi/cgi-bin/ssialias?htmlfid=SEL03130WWEN&) – а это много времени для нанесения ущерба. |

## Является ли приложение уязвимым?

Недостаточно регистрировать, обнаруживать, контролировать и активно реагировать в любое время:

* Аудитируемые события, такие как логины, неудачные логины, и транзакции с высокой стоимостью не регистрируются.
* Предупреждения и ошибки не генерируют никаких, неадекватных или нечетких сообщений журнала.
* Журналы приложений и API не контролируются на предмет подозрительной активности.
* Журналы хранятся только локально.
* Соответствующие пороговые значения предупреждений и процессы эскалации ответных мер настроены неправильно или не действуют.
* Проникновение и сканирование с помощью инструментов [DAST](https://www.owasp.org/index.php/Category:Vulnerability_Scanning_Tools) (например [OWASP ZAP](https://www.owasp.org/index.php/OWASP_Zed_Attack_Proxy_Project)) не вызывают предупреждения.
* Приложение не может обнаруживать, эскалировать или предупреждать о активных атаках в реальном времени или в режиме реального времени.

Вы уязвимы для утечки информации, если вы делаете записи и уведомления о событиях видимыми для пользователя или злоумышленника (см. A3:2017-Разглашение конфиденциальных данных).

## Как предотвратить

В соответствии с риском потери данных, сохраняемых или обрабатываемых приложением:

* Убедитесь, что все логины, сбои контроля доступа и сбои проверки подлинности на стороне сервера могут быть зарегистрированы с достаточным контекстом пользователя для выявления подозрительных или злонамеренных учетных записей и удерживаться в течение достаточного времени, чтобы позволить отсроченный судебно-медицинский анализ.
* Убедитесь, что журналы создаются в формате, который можно легко использовать централизованными решениями управления журналами.
* Убедитесь, что транзакции с высокой стоимостью имеют контрольный журнал с элементами управления целостностью для предотвращения несанкционированного доступа или удаления, например использовать таблицы баз данных, в которые можно только дописывать значения или нечто подобное.
* Создать эффективный мониторинг и оповещения, чтобы своевременно выявлять подозрительные действия и реагировать на них.
* Создать или принять план реагирования на инциденты и восстановления, например  [NIST 800-61 rev 2](https://csrc.nist.gov/publications/detail/sp/800-61/rev-2/final) или позже.

Существуют коммерческие и открытые среды защиты приложений, такие как [OWASP AppSensor](https://www.owasp.org/index.php/OWASP_AppSensor_Project), брандмауэры веб-приложений, такие как [ModSecurity with the OWASP ModSecurity Core Rule Set](https://www.owasp.org/index.php/Category:OWASP_ModSecurity_Core_Rule_Set_Project), и программное обеспечение корреляции журналов с пользовательскими панелями мониторинга и оповещениями. 

## Примеры сценариев атак

**Сценарий #1**: Программное обеспечение форума с открытым исходным кодом, разработанное небольшой командой, было взломано с использованием недостатка в его программном обеспечении. Нападавшим удалось уничтожить внутренний репозиторий исходного кода, содержащий следующую версию, и все содержимое форума. Хотя источник может быть восстановлен, отсутствие контроля, регистрации или оповещения привело к значительно более серьезному нарушению. В результате инцидента форум более неактивен.

**Сценарий #2**: Злоумышленник использует сканирование для пользователей, использующих общий пароль. Они могут использовать все учетные записи, используя этот пароль. Для всех других пользователей это сканирование оставляет только один ложный логин. Через несколько дней это может повторяться с другим паролем.

**Сценарий #3**: По сообщениям, у крупного американского розничного продавца была встроенная программа для анализа вредоносных программ, анализирующая вложения. Программное обеспечение песочницы обнаружило потенциально нежелательное программное обеспечение, но никто не ответил на это обнаружение. Песочница издавала предупреждения в течение некоторого времени, прежде чем нарушение было обнаружено из-за мошеннических транзакций карты внешним банком.

## Ссылки

### OWASP

* [OWASP Проактивные элементы управления: внедрение регистрации и обнаружения вторжений](https://www.owasp.org/index.php/OWASP_Proactive_Controls#8:_Implement_Logging_and_Intrusion_Detection)
* [OWASP Стандарт проверки безопасности приложений: ведение журнала и мониторинг V8](https://www.owasp.org/index.php/Category:OWASP_Application_Security_Verification_Standard_Project#tab=Home)
* [OWASP Руководство по тестированию: тестирование подробного кода ошибки](https://www.owasp.org/index.php/Category:OWASP_Application_Security_Verification_Standard_Project#tab=Home)
* [OWASP Шпаргалка: логирование](https://www.owasp.org/index.php/Logging_Cheat_Sheet)

### Сторонние

* [CWE-223: Отсутствие информации, относящейся к безопасности](https://cwe.mitre.org/data/definitions/223.html)
* [CWE-778: Недостаточное логирование](https://cwe.mitre.org/data/definitions/778.html)
