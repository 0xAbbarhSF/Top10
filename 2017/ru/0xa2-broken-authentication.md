# A2:2017 Недостатки аутентификации

| Угрозы/Векторы атаки | Слабые места безопасности           | Нападение               |
| -- | -- | -- |
| Уровень доступа : Уязвимости 3 | Распространённость 2 : Обнаруживаемость 2 | Технический 3 : Бизнес |
| У атакующих есть доступ к сотням миллионов действующих комбинаций имён и паролей пользователей для заполнения учетных данных, административных списков по умолчанию, автоматического перебора и атак по словарю. Управление сеансами атак хорошо понятно, особенно в отношении неработающих токенов сеанса. | Недостатки аутентификации широко распространены благодаря разработке и внедрению большинства средств идентификации и контроля доступа. Управление сеансом является основой аутентификации и контроля доступа и присутствует во всех приложениях с поддержкой состояния. Атакующие могут обнаруживать сломанную аутентификацию с использованием ручных средств и использовать их с помощью автоматических инструментов со списками паролей и атаками по словарю. | Злоумышленники должны получить доступ только к нескольким учетным записям или только к одной учетной записи администратора, чтобы скомпрометировать систему. В зависимости от области применения приложения это может привести к отмыванию денег, мошенничеству в области социального обеспечения и краже личных данных или раскрывать конфиденциальную информацию, охраняемую законом. |

## Является ли приложение уязвимым?

Подтверждение идентификации пользователя, аутентификации и управления сеансом имеет решающее значение для защиты от атак, связанных с аутентификацией.

Недостатки проверки подлинности возникают, если приложение:

* Разрешает автоматические атаки, такие как [учетные данные](https://www.owasp.org/index.php/Credential_stuffing), где у злоумышленника есть список допустимых имен пользователей и паролей.
* Разрешает перебор или другие автоматические атаки.
* Разрешает пароли по умолчанию, слабые или известные пароли, такие как "Password1" или "admin/admin“.
* Использует слабое или неэффективное восстановление учетных данных и забытого пароля, такие как «ответы на основе знаний», которые нельзя сделать безопасными.
* Использует простые текстовые, зашифрованные или слабо хешированные пароли (см. **A3: 2017-Разглашение конфиденциальных данных**).
* Отсутствует или неэффективна многофакторная аутентификация.
* Выдает идентификаторы сеанса в URL-адресе (например, переписывание URL-адресов).
* После успешного входа в систему не возвращает идентификаторы сеанса.
* Не корректно аннулирует идентификаторы сеанса. Пользовательские сеансы или токены аутентификации (в частности, токены единого входа (SSO)) не уничтожаются должным образом во время выхода из системы или периода бездействия.

## Как предотвратить

* Там, где это возможно, реализуйте многофакторную аутентификацию для предотвращения автоматических атак, кражи учетных данных, перебора и кражи для повторных атак.
* Не работайте под учетными данными по умолчанию, особенно для пользователей admin.
* Внедряйте проверки слабых паролей, такие как проверка новых или измененных паролей по списку [топ-10000 наихудших паролей](https://github.com/danielmiessler/SecLists/tree/master/Passwords).
* Применяйте правила длины, сложности и ротации паролей с помощью [NIST 800-63 B разделе 5.1.1 для запомненных секретов](https://pages.nist.gov/800-63-3/sp800-63b.html#memsecret) или используйте другие современные, основанные на доказательствах политики паролей подходы.
* Обеспечьте, чтобы регистрация, восстановление учетных данных и пути API были усилены против атак на аккаунты, используя одни и те же сообщения для всех результатов.
* Ограничте колличество или увеличте задержки неудачных попыток входа в систему. Логируйте все отказы и административные предупреждения, при работе с учетными данными, их перебором или другими атаками.
* Используйте серверный, безопасный, встроенный диспетчер сеансов, который генерирует новый случайный идентификатор сеанса с высокой энтропией после входа в систему. Идентификаторы сеансов не должны находиться в URL-адресе, должны быть надежно сохранены и аннулированы после выхода из системы, бездействия и абсолютных тайм-аутов.

## Пример сценария атаки

**Сценарий #1**: [Учётные данные](https://www.owasp.org/index.php/Credential_stuffing), использование [списка известных паролей](https://github.com/danielmiessler/SecLists), является обычной атакой. Если приложение не реализует автоматическую защиту учетных данных или предотвращение угроз, то приложение может использоваться в качестве пароля для определения того, действительны ли учетные данные.

**Сценарий #2**: Большинство атак аутентификации происходят из-за постоянного использования паролей в качестве единственного фактора. После рассмотрения передовой практики, ротация пароля и изменение требований к его сложности рассматриваются как поощряющие пользователей к использованию и повторному использованию слабых паролей. Организациям рекомендуется прекратить эту практику в NIST 800-63 и использовать многофакторную аутентификацию.

**Сценарий #3**: Таймауты сеанса приложения не установлены должным образом. Пользователь использует общедоступный компьютер для доступа к приложению. Вместо выбора «logout» пользователь просто закрывает вкладку браузера и уходит. Злоумышленник использует тот же браузер через час, и пользователь все еще аутентифицирован.

## Ссылки

### OWASP

* [Проактивная защита OWASP: реализация защиты идентификационных данных и аутентификации](https://www.owasp.org/index.php/OWASP_Proactive_Controls#5:_Implement_Identity_and_Authentication_Controls)
* [Стандарт подтверждения безопасности приложений OWASP (ASVS): V2 Аутентификация](https://www.owasp.org/index.php/Category:OWASP_Application_Security_Verification_Standard_Project#tab=Home)
* [Стандарт подтверждения безопасности приложений OWASP (ASVS): V3 Управление сессиями](https://www.owasp.org/index.php/Category:OWASP_Application_Security_Verification_Standard_Project#tab=Home)
* [Руководство OWASP по тестированию: Идентификационные данные](https://www.owasp.org/index.php/Testing_Identity_Management)
 и [Аутентификация](https://www.owasp.org/index.php/Testing_for_authentication)
* [Памятка OWASP: Аутентификация](https://www.owasp.org/index.php/Authentication_Cheat_Sheet)
* [Памятка OWASP: Утечка учётных данных](https://www.owasp.org/index.php/Credential_Stuffing_Prevention_Cheat_Sheet)
* [Памятка OWASP: Забытый пароль](https://www.owasp.org/index.php/Forgot_Password_Cheat_Sheet)
* [Памятка OWASP: Управление сессиями](https://www.owasp.org/index.php/Session_Management_Cheat_Sheet)
* [Справочник OWASP по автоматизированным атакам](https://www.owasp.org/index.php/OWASP_Automated_Threats_to_Web_Applications)

### Сторонние

* [NIST 800-63b: 5.1.1 Запоминаемые секреты](https://pages.nist.gov/800-63-3/sp800-63b.html#memsecret) - для получения исчерпывающей, актуальной и основанной на фактических данных справки по аутентификации. 
* [CWE-287: Некорректная аутентификация](https://cwe.mitre.org/data/definitions/287.html)
* [CWE-384: Фиксация сессии](https://cwe.mitre.org/data/definitions/384.html)
