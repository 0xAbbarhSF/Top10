# A3:2017 Разглашение конфиденциальных данных

| Угрозы/Векторы атаки | Слабые места безопасности | Нападение |
| -- | -- | -- |
| Уровень доступа Lvl : Уязвимости 2 | Распространённость 3 : Обнаруживаемость 2 | Технический 3 : Бизнес |
| Вместо прямой крипто атаки, злоумышленники крадут ключи, выполняют атаки по принцыпу «человек в середине» или крадут четкие текстовые данные с сервера, пока они передаются, или от клиента пользователя, например через браузер. Обычно требуется управлять атакой вручную. Предварительно пароль от базы данных могут получить методом перебора используя  графические процессоры (GPUs). | За последние несколько лет это была наиболее распространенная атака. Типичным недостатком является отсутствие шифрования конфиденциальных данных. При использовании криптографии, слабая генерация ключей и управление ими, а также слабый алгоритм, использование протокола и шифрования является обычным явлением, особенно для слабых методов хранения хэширования пароля. Для передающихся данных, недостатки на стороне сервера в основном легко обнаруживаются, что затруднено для данных в состоянии покоя. | Сбой часто компрометирует все данные, которые должны были быть защищены. Как правило, эта информация включает данные конфиденциальной личной информации (PII), такие как медицинские записи, учетные данные, персональные данные и кредитные карты, которые часто требуют защиты, как это определено законами или правилами, такими как евростандарт GDPR или местными законами о конфиденциальности.|

## Является ли приложение уязвимым?

Во-первых, необходимо определить потребности защиты данных во время передачи и в состоянии покоя. Например, пароли, номера кредитных карт, медицинские записи, личная информация и коммерческая тайна требуют дополнительной защиты, особенно если эти данные попадают в законы о конфиденциальности, например "Общие правила защиты данных ЕС" (GDPR) или нормативные акты, например финансовой защиты данных, такой как "Cтандарт безопасности данных PCI" (PCI DSS). Для всех таких данных:

* Являются ли какие-либо данные переданы в читабельном тексте? Это касается протоколов, таких как HTTP, SMTP и FTP. Особенно опасен внешний интернет-трафик. Проверьте весь внутренний трафик, например между балансировщиками нагрузки, веб-серверами или внутренними системами.
* Существуют ли старые или слабые криптографические алгоритмы, используемые по умолчанию или в более раннем коде? 
* Используются ли крипто-ключи по умолчанию, слабые криптографические ключи, сгенерированные или повторно используемые, или правильное управление ключами или замены отстутствует?
* Является ли шифрование обязательным, например любой ли пользовательский агент (баузер) использует директивы безпосасности или заголовки?
* Проверяет ли пользовательский агент (например, приложение, почтовый клиент) действителен ли сертификат принятого сервера?

Смотрите ASVS [Криптография (V7)](https://www.owasp.org/index.php/ASVS_V7_Cryptography), [Защита данных (V9)](https://www.owasp.org/index.php/ASVS_V9_Data_Protection) and [SSL/TLS (V10)](https://www.owasp.org/index.php/ASVS_V10_Communications).

## Как предотвратить?

Выполните, как минимум, следующие рекомендации:

* Классифицируйте данные, обрабатываемые, сохраненные или переданные приложением. Определите, какие данные являются конфеденциальными в соответствии с законодательством о конфиденциальности, нормативными требованиями или потребностями бизнеса.
* Примените элементы управления в соответствии с классификацией.
* Не храните конфиденциальные данные без необходимости. Откажитесь от такого подхода как можно скорее или используйте токенизацию, совместимую с PCI DSS, или даже усечение. Данные, которые не сохранены, не могут быть украдены.
* Обязательно зашифруйте все конфиденциальные данные в покое.
* Обеспечьте наличие современных и надежных стандартных алгоритмов, протоколов и ключей; используйте правильное управление ключами.
* Шифруйте все данные во время передачи с помощью защищенных протоколов, таких как TLS с совершенными шифрами прямой секретности (PFS), приоритетным серверным шифрованием и безопасными параметрами. Обеспечьте шифрование с помощью таких директив, как HTTP Strict Transport Security (HSTS).
* Отключите кэширование для ответа, содержащего конфиденциальные данные.
* Храните пароли с использованием сильных адаптивных и солёных функций хэширования с коэффициентом работы (фактором задержки), например [Argon2](https://www.cryptolux.org/index.php/Argon2), [scrypt](https://wikipedia.org/wiki/Scrypt), [bcrypt](https://wikipedia.org/wiki/Bcrypt) or [PBKDF2](https://wikipedia.org/wiki/PBKDF2).
* Независимо проверяйте эффективность конфигурации и настроек.

## Пример сценария атаки

**Сценарий #1**: Приложение шифрует номера кредитных карт в базе данных, используя автоматическое шифрование базы данных. Однако эти данные автоматически дешифруются при извлечении, что позволяет дефекту SQL-инъекции извлекать номера кредитных карт в явном виде.

**Сценарий #2**: Сайт не использует или не применяет TLS для всех страниц или поддерживает слабое шифрование. Злоумышленник отслеживает сетевой трафик (например, в небезопасной беспроводной сети), понижает соединения с HTTPS на HTTP, перехватывает запросы и крадет cookie сеанса пользователя. Затем злоумышленник использует этот файл cookie и захватывает сеанс пользователя (аутентифицируется), получая доступ к или изменяя личные данные пользователя. Злоумышленник может изменить все передаваемые данные, например поменять получателя денежного перевода.

**Сценарий #3**: База данных использует несоленые или простые хэши для хранения паролей всех пользователей. Ошибка загрузки файла позволяет злоумышленнику получить пароль базы данных. Все несоленые хеши могут быть прочитаны с помощью радужной таблицы предварительно рассчитанных хэшей. Хэши, созданные с помощью простых или быстрых хеш-функций, могут быть взломаны графическими процессорами, даже если они содержали соль. 

## Рекомендации

* [OWASP Проактивные элементы управления: защита данных](https://www.owasp.org/index.php/OWASP_Proactive_Controls#7:_Protect_Data)
* [OWASP Стандарт проверки безопасности приложений]((https://www.owasp.org/index.php/Category:OWASP_Application_Security_Verification_Standard_Project)): [V7](https://www.owasp.org/index.php/ASVS_V7_Cryptography), [9](https://www.owasp.org/index.php/ASVS_V9_Data_Protection), [10](https://www.owasp.org/index.php/ASVS_V10_Communications)
* [OWASP Шпаргалка: Защита транспортного уровня](https://www.owasp.org/index.php/Transport_Layer_Protection_Cheat_Sheet)
* [OWASP Шпаргалка: Защита конфиденциальности пользователя](https://www.owasp.org/index.php/User_Privacy_Protection_Cheat_Sheet)
* [OWASP Шпаргалка: Пароль](https://www.owasp.org/index.php/Password_Storage_Cheat_Sheet) and [Криптографическое хранилище](https://www.owasp.org/index.php/Cryptographic_Storage_Cheat_Sheet)
* [OWASP Проект заголовков безопасности](https://www.owasp.org/index.php/OWASP_Secure_Headers_Project); [Шпаргалка: HSTS](https://www.owasp.org/index.php/HTTP_Strict_Transport_Security_Cheat_Sheet)
* [OWASP Руководство по тестированию: тестирование на слабую криптографию](https://www.owasp.org/index.php/Testing_for_weak_Cryptography)

### External

* [CWE-220: Экспозиция конфиденциальной информации через запросы данных](https://cwe.mitre.org/data/definitions/220.html)
* [CWE-310: Криптографические проблемы](https://cwe.mitre.org/data/definitions/310.html); [CWE-311: Отсутствие шифрования](https://cwe.mitre.org/data/definitions/311.html)
* [CWE-312: Нешифрованое хранение конфиденицальной информации](https://cwe.mitre.org/data/definitions/312.html)
* [CWE-319: Нешифрованная передача конфиденциальной информации](https://cwe.mitre.org/data/definitions/319.html)
* [CWE-326: Слабое шифрование](https://cwe.mitre.org/data/definitions/326.html); [CWE-327: Сломанное/рисковое шифрование](https://cwe.mitre.org/data/definitions/327.html)
* [CWE-359: Воздействие частной информации - нарушение конфиденциальности](https://cwe.mitre.org/data/definitions/359.html)
